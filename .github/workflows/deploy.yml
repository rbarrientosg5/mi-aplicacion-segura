name: ğŸš€ Despliegue Seguro con CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    name: ğŸ”’ Escaneo de Seguridad
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Descargar cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸ›¡ï¸ AnÃ¡lisis de cÃ³digo
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ğŸ” Buscar vulnerabilidades bÃ¡sicas
      run: |
        echo "ğŸ” Escaneando cÃ³digo..."
        # Busca patrones bÃ¡sicos de inseguridad
        if grep -r "password" . --include="*.js" --include="*.html"; then
          echo "âš ï¸  Posible contraseÃ±a hardcodeada encontrada"
        else
          echo "âœ… No se encontraron contraseÃ±as hardcodeadas"
        fi
        
        # Verifica que existan los archivos esenciales
        if [ -f "index.html" ] && [ -f "script.js" ] && [ -f "style.css" ]; then
          echo "âœ… Todos los archivos esenciales presentes"
        else
          echo "âŒ Faltan archivos esenciales"
          exit 1
        fi

  tests:
    name: ğŸ§ª Pruebas Automatizadas
    runs-on: ubuntu-latest
    needs: security-scan
    
    steps:
    - name: ğŸ“¥ Descargar cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸ§ª Ejecutar pruebas bÃ¡sicas
      run: |
        echo "ğŸ§ª Ejecutando pruebas de validaciÃ³n..."
        # Prueba que el HTML sea vÃ¡lido
        if grep -q "<!DOCTYPE html>" index.html; then
          echo "âœ… HTML tiene DOCTYPE vÃ¡lido"
        else
          echo "âŒ HTML sin DOCTYPE vÃ¡lido"
          exit 1
        fi
        
        # Prueba que el JavaScript tenga validaciÃ³n
        if grep -q "validateEmail" script.js; then
          echo "âœ… FunciÃ³n de validaciÃ³n encontrada"
        else
          echo "âŒ No se encontrÃ³ funciÃ³n de validaciÃ³n"
          exit 1
        fi

  deploy:
    name: ğŸš€ Desplegar a ProducciÃ³n
    runs-on: ubuntu-latest
    needs: tests
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ Descargar cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸš€ Desplegar
      run: |
        echo "ğŸ‰ Â¡Despliegue automÃ¡tico completado!"
        echo "ğŸ“Š Resumen:"
        echo "   âœ… Escaneo de seguridad pasado"
        echo "   âœ… Pruebas automatizadas pasadas" 
        echo "   ğŸš€ AplicaciÃ³n lista para producciÃ³n"
        echo "   ğŸ”’ PrÃ¡cticas de seguridad validadas"
